
	<link rel="stylesheet" href="https://www.notion.so/app-21eb0c05ca983c393d67.css">
	<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script></head>
<div id="explorerForm">
     <div class="elementor-row">

	
	<textarea id="segmentIn" placeholder="add the segments you want to filter by below">
		
		
	</textarea>
	
	
	
 <p><button class="select" type="button" tabindex="5" style="margin-bottom: 1em">Copy Case Statement</button> 	
	
	<textarea id="segmentOutput" class="select hiddenTextarea" readonly="readonly" rows="1" >
		
		
	</textarea>
	
	     </ul>
	
	
	
	
		     <h2>How to build Segments using Regular Expressions</h2>
	     <p>Use the following structure:</p>
	     <code>Capture Path::Label</code>

	     <p>This uses the FullPath field. Use the following structure:</p>
<ul>
	<li>^/string/::Label  - captures all URLs starting with /string/ in the URL</li>
	<li>^/string/$ ::Label  - (with a ^ at start & a $ at end) captures all URLs = /string/</li>
	<li>string/::Label  - captures all URLs with string/ in the URL</li>
	<li>string::Label  - captures all URLs with string in the URL</li>
	     </ul>
          <ol id="directions">

        <li><strong>Paste in the New Explorer Data Studio Report URL: (required) <br> <span style="font-size: 0.75em">example:
                    https://datastudio.google.com/u/0/reporting/xxxxxx-31cb-4xxxx-9acf-xxxxxxxx4847/page/q8oSC/edit</span></strong>
                <input id="report" tabindex="1" type="text" style="width: 100%; line-height: 2em; padding: 0.5em 0.5 em 0.25em" /></p></li>
                        <li><strong>Hit the 'Tab' key</strong></li></ol></div>

    <div class="elementor-row">
          
                      <div class="elementor-column elementor-col-100"  data-element_type="column">
 
    <p><button class="select" type="button" tabindex="5" style="margin-bottom: 1em">Copy Root Queries</button> <textarea
            id="root" class="select hiddenTextarea" readonly="readonly" rows="1"  >	</textarea></p></div>
	    
	    <div class="elementor-column elementor-col-100"  data-element_type="column">
 
    <p><button class="select" type="button" tabindex="5" style="margin-bottom: 1em">Copy FullPath</button> <textarea
            id="fullPath" class="select hiddenTextarea" readonly="readonly" rows="1"  >	</textarea></p></div>
	    

	     <div class="elementor-column elementor-col-100"  data-element_type="column">
 
    <p><button class="select" type="button" tabindex="5" style="margin-bottom: 1em">Copy Trending Queries</button> <textarea
            id="trending" class="select hiddenTextarea" readonly="readonly" rows="1"  >	</textarea></p></div>
            
            <div class="elementor-column elementor-col-100"  data-element_type="column">
    
    <p><button class="select" type="button" tabindex="5" style="margin-bottom: 1em">Copy Trending Pages</button> <textarea
            id="pageexplorer" class="select hiddenTextarea" readonly="readonly" rows="1" >	</textarea></p></div></div>
            

              <div class="elementor-row">           <div class="elementor-column elementor-col-100"  data-element_type="column"> 
     <p><button class="select" type="button" tabindex="8" style="margin-bottom: 1em">Copy Check Serps</button> <textarea
            id="checkSerps" class="select hiddenTextarea" readonly="readonly" rows="1">HYPERLINK(CONCAT("https://google.com/search?q=",REGEXP_REPLACE(query,' ','+')),"ðŸ”ŽSERPS")</textarea></p>

</div>
<div class="elementor-column elementor-col-100"  data-element_type="column">
      
       
     <p><button class="select" type="button" tabindex="10" style="margin-bottom: 1em">Copy Image Serps</button> <textarea
            id="checkQuora" class="select hiddenTextarea" readonly="readonly" rows="1" >HYPERLINK(CONCAT("https://google.com/search?q=",REGEXP_REPLACE(Query,' ','+'),"&tbm=isch"),"ðŸ”ŽImages")</textarea></p>
       </div>

      <div class="elementor-column elementor-col-100"  data-element_type="column">   
     <p><button class="select" type="button" tabindex="10" style="margin-bottom: 1em">Copy Quora</button> <textarea
            id="checkQuora" class="select hiddenTextarea" readonly="readonly" rows="1" >HYPERLINK(CONCAT("https://www.quora.com/search?q=",REGEXP_REPLACE(query,' ','%20')),IMAGE("https://upload.wikimedia.org/wikipedia/commons/2/2c/Quora_icon.png","Q"))</textarea></p>

</div> 

<div class="elementor-column elementor-col-100"  data-element_type="column">   
     <p><button class="select" type="button" tabindex="9" style="margin-bottom: 1em">Copy Reddit</button> <textarea
            id="checkReddit" class="select hiddenTextarea" readonly="readonly"  rows="1">HYPERLINK(CONCAT("https://www.reddit.com/search/?q=",REGEXP_REPLACE(query,' ','%20')),IMAGE("https://external-preview.redd.it/iDdntscPf-nfWKqzHRGFmhVxZm4hZgaKe5oyFws-yzA.png?auto=webp&s=38648ef0dc2c3fce76d5e1d8639234d8da0152b2","Q"))</textarea></p>

</div>

</div>

  


    <style>
        .hidden {
            display: none;
        }
        .elementor-column.elementor-col-100,.elementor-column.elementor-col-50 {padding: 5px 5px 5px 40px!important;display: flex;float: left !important}
	    .elementor-row {width: 100%; display: block; float: left !important}

         .elementor-column.elementor-col-100 p button {width: 100%;clear: both;}

	    .elementor-column button {
  border-style: solid;
  border-top-width: 0;
  border-right-width: 0;
  border-left-width: 0;
  border-bottom-width: 0;
  color: #000;
  border-color: #d39078;
  background-color: #d39078;
  border-radius: 7px;
  padding-top: 14px;
  padding-right: 40px;
  padding-bottom: 14px;
  padding-left: 40px;
  font-family: inherit;
  font-weight: 600;
		    font-size: 16px;
  line-height: 1;
  text-transform: lowercase;
}
    </style>

    <script>
        jQuery(function ($) {

            $("button#buildSegments").click(function () {
		    setSegmenets();
		 $(this).closest('p').find('textarea').select();
                document.execCommand('copy');    
	function setSegments() {
  let segmentIn = [];
    try {
     
      
      //console.log(data);
  let data = document.getElementById("segmentIn").value.replace(/\n/g, ",").split(",").filter((x)=>{return x !=='';});
      for (let i = 0; i < data.length; i++) {
        let row = data[i];
        
        segmentIn.push(row);
      }
  

  console.log('segmentIn inside sorting function: ', segmentIn);
  segmentIn = segmentIn.sort(function (a, b) {
    let itemA = a.split('::')[0];
    let itemB = b.split('::')[0];
    // console.log('a: ', itemA, 'b: ', itemB);
    if (itemA.match('/') && itemB.match('/')) {
      if (itemA.split('/').length > itemB.split('/').length) return -1;
      if (itemA.split('/').length < itemB.split('/').length) return 1;
    }
    if (itemA.match('/') && !itemB.match('/')) {
      return -1;
    }
    if (itemA.length > itemB.length) return -1;
    if (itemA.length < itemB.length) return 1;
  });

  //build segments
  segmentPattern = `CASE`;

  for (let i = 0; i < segmentIn.length; i++) {
    let row = segmentIn[i];
    let regexIn = row.split('::')[0];
    let value = row.split('::')[1];
    let regexMid = regexIn.replace(/\|/g, '.*|.*');
    let regex = `.*${regexMid}.*`;
    segmentPattern += `
WHEN REGEXP_CONTAINS(FullPath,"${regex}") THEN "${value}"`;
  }
  segmentPattern += `
ELSE "Other"
END`;

      
document.getElementById("segmentOutput").value = segmentPattern;

               
} catch (e) {
  console.log(e);
  var log = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('log');
  log.getRange(log.getLastRow() + 1, 1, 1, 3).setValues([[new Date(), options.payload, JSON.stringify(e)]]);
}
}   
		    
		    
	    });

        });
    </script>
    </div>
    <style>.hiddenTextarea {
  position: absolute;
  opacity: .01;
  height: 0;
  overflow: hidden;
}</style>

